<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - –ö–ª–∏–µ–Ω—Ç–ª–∞—Ä –ë–∞–∑–∞—Å–∏</title>
    <style>
        /* Loading Screen (CSS file yuklanguncha ko'rinib turishi uchun) */
        body { font-family: sans-serif; margin: 0; background-color: #f3f4f6; }
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #667eea; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; color: white; transition: opacity 0.5s; }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }
        .loader { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loader"></div>
        <p>–¢–∏–∑–∏–º –∏—à–≥–∞ —Ç—É—à–º–æ“õ–¥–∞...</p>
    </div>
    <!-- Login Page -->
    <div id="loginPage" class="page login-page hidden">
        <div style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin: 2rem auto;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h1 style="color: #4f46e5; margin: 0;">CRM –°–∏—Å—Ç–µ–º–∞</h1>
                <p style="color: #6b7280; margin-top: 5px;">–ö–ª–∏–µ–Ω—Ç–ª–∞—Ä –±–∞–∑–∞—Å–∏</p>
            </div>
            <form id="loginForm">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 5px; color: #374151;">Email</label>
                    <input type="email" id="loginEmail" placeholder="email@example.com" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 5px; color: #374151;">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                </div>
                <button type="submit" style="width: 100%; background: #4f46e5; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">–ö–∏—Ä–∏—à</button>
            </form>
        </div>
    </div>
    <!-- Main App (Dashboard) -->
    <div id="mainApp" class="hidden">
        <div style="padding: 2rem;">
            <h1>–•—É—à –∫–µ–ª–∏–±—Å–∏–∑!</h1>
            <p>–¢–∏–∑–∏–º –º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç–ª–∏ —é–∫–ª–∞–Ω–¥–∏.</p>
            <div id="dashboardContent">
                <!-- Dashboard content will be loaded by app.js -->
            </div>
             <button id="logoutBtn" style="background: #ef4444; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">–ß–∏“õ–∏—à</button>
        </div>
    </div>
    <!-- Firebase & App Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        const firebaseConfig = {
            apiKey: "AIzaSyDPIrieoenqtwzD2A-QzxHknztZKtOaf18",
            authDomain: "bigsport-crm.firebaseapp.com",
            projectId: "bigsport-crm",
            storageBucket: "bigsport-crm.firebasestorage.app",
            messagingSenderId: "645659654481",
            appId: "1:645696694481:web:e65a139cb67e68b8787df0",
            measurementId: "G-RKSKY82609"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        console.log("‚úÖ Firebase (HTML) initialized");
        // UI Elements
        const loading = document.getElementById('loadingScreen');
        const loginPage = document.getElementById('loginPage');
        const mainApp = document.getElementById('mainApp');
        const loginForm = document.getElementById('loginForm');
        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            loading.classList.add('hidden');
            if (user) {
                console.log("üë§ User logged in:", user.email);
                loginPage.classList.add('hidden');
                mainApp.classList.remove('hidden');
            } else {
                console.log("üëã No user");
                mainApp.classList.add('hidden');
                loginPage.classList.remove('hidden');
            }
        });
        // Login Handler
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const btn = e.target.querySelector('button');
                
                try {
                    btn.textContent = "–ö–∏—Ä–∏–ª–º–æ“õ–¥–∞...";
                    btn.disabled = true;
                    await signInWithEmailAndPassword(auth, email, password);
                    // onAuthStateChanged handles the rest
                } catch (error) {
                    console.error("Login Error:", error);
                    alert("–•–∞—Ç–æ: " + error.message);
                    btn.textContent = "–ö–∏—Ä–∏—à";
                    btn.disabled = false;
                }
            });
        }
        
        // Make Logout global so app.js can use it or buttons work
        window.logout = () => signOut(auth);
        document.getElementById('logoutBtn')?.addEventListener('click', window.logout);
    </script>
   
    <!-- Load App Logic (Module) -->
    <script type="module" src="app.js"></script>
</body>
</html>
